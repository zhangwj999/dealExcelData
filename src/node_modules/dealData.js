const gcoord = require( 'gcoord' )
const _ = require( 'lodash' )

exports.dealDatas = function dealDatas( datas ){
	_.forEach( datas, ( d )=>{
		if( !d.longitude || !d.latitude ){
			console.log( 'before deal: ' )
			console.log( d )
			let rlt = transBd2Gps( d.bdlongitude, d.bdlatitude )
			d.longitude = rlt[0]
			d.latitude = rlt[1]
			console.log( 'after deal: ' )
			console.log( d )
		}
	})
}

/**
 * 将BD坐标，转为GPS坐标
 * @param {*} long 维度
 * @param {*} lati 经度
 */
const transBd2Gps = exports.transBd2Gps = ( long, lati )=>{
	if( long && lati ){
		long = parseFloat( long )
		lati = parseFloat( lati )
		var result = gcoord.transform(
			[ long, lati ],    // 经纬度坐标
			gcoord.BD09,                 // 当前坐标系
			gcoord.WGS84                   // 目标坐标系
		);
		return result
	}else{
		return [ long, lati ]
	}
}
