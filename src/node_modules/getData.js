const XLSX = require( 'xlsx' )
const _ = require( 'lodash' )

module.exports = function getData( path ){
	let rlt = XLSX.readFile( path, {
		type: 'file'
	} )
	let ws = rlt.Sheets.Sheet1
	// console.log( XLSX.utils.sheet_to_json( ws ) )
	let ref = ws['!ref']
	let ranges = ref.split( ':' ) // A1:A10
	var rltData = []
	var props = []
	var noLatiCount = 0
	for( var i = parseInt( ranges[0].substring( 1 ) ); i < parseInt( ranges[1].substring( 1 ) ); i++ ){
		if( i == 1 ){
			props = ws['A'+i].v.split( ',' )
		}else{
			let tmp = {}
			let vals = ws['A'+i].v.split( ',' )
			_.forEach( vals, ( d, idx )=>{
				tmp[ props[idx] ] = d
			})

			rltData.push( tmp )

			if( !tmp['longitude'] ){
				noLatiCount++
				// console.log( tmp )
			}
			console.log( noLatiCount )
		}
	}
	return rltData
}
